---
title: Mysql索引 
create: 2023/01/11 00:53
auther: four1er
tags: 
- Mysql
- 
---
# 索引的常见模型
- 哈希表
- 有序数组
- 搜索树
对于哈希表来说，等值查询的速度很快，而且插入数据也很方便，直接追加就可以。
对于有序数组来说，在等值查询和范围查询的场景中性能都很优秀，但是在更新数据的时候，就很麻烦，所以有序数组索引只适用于静态存储引擎。
搜索树，InnoDB 使用的是 B+树索引模型。

主键索引的叶子节点存的是整行数据，在 InnoDB 里面，主键索引也被称为聚簇索引。
非主键索引的叶子节点内容是主键的值，在 InnoDB 里面，非主键索引也被称为二级索引。

根据上面的索引结构说明，我们来讨论一个问题：**基于主键索引和普通索引的查询有什么区别？**

-   如果语句是select * from T where ID=500，即主键查询方式，则只需要搜索ID这棵B+树；
-   如果语句是select * from T where k=5，即普通索引查询方式，则需要先搜索k索引树，得到ID的值为500，再到ID索引树搜索一次。这个过程称为回表。

也就是说，基于非主键索引的查询需要多扫描一棵索引树。因此，我们在应用中应该尽量使用主键查询。

覆盖索引：当需要 select 的字段在索引树上时，就可以直接提供查询结果，不需要进行回表。也就是说，在这个查询里面，索引 k 已经“覆盖了”我们的查询需求，我们称为覆盖索引。

**由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。**

# 最左前缀原则
对于一个联合索引来说，索引项是按照索引定义里面出现的字段顺序排序的。

如果你要查的是所有名字第一个字是“张”的人，你的 SQL 语句的条件是"where name like ‘张 %’"。这时，你也能够用上这个索引，查找到第一个符合条件的记录是 ID3，然后向后遍历，直到不满足条件为止。

可以看到，不只是索引的全部定义，只要满足最左前缀，就可以利用索引来加速检索。这个最左前缀可以是联合索引的最左 N 个字段，也可以是字符串索引的最左 M 个字符。

## **建立联合索引的字段顺序**

这里我们的评估标准是，索引的复用能力。因为可以支持最左前缀，所以当已经有了 (a,b) 这个联合索引后，一般就不需要单独在 a 上建立索引了。因此，**第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。**